{"version":3,"sources":["../src/init.js"],"names":["define","$","init","hasClass","window","console","log","options","M","str","moodle","filter","DataTable","dt_elt","build_child_row","dataobject","childrow","overridetime","overridestatus","overrider","overridereason","OverrideUi","e","preventDefault","elt","self","frm","find","prefix","elt_edit","elt_status","elt_reason","userinputs","elt_targetuserid","elt_overrideuserid","elt_save","elt_loading","elt_cancel","attr","block_integrityadvocate","override_reason_label","on","keyCode","which","click","hide","save_set_status","trigger","validate_all","save_click","show_overrideui","cancel_click","each","_","userinput","hide_overrideui","closest","show","disable_ui","url","URL","location","href","require","ajax","notification","call","methodname","args","status","val","reason","targetuserid","overrideuserid","blockinstanceid","searchParams","get","moduleid","parents","done","reload","fail","exception","always","enable_ui","isvalid_reason","validate_reason","isvalid_status","validate_status","checkValidity","setCustomValidity","override_reason_invalid","enabled","save_enable","save_disable","css","preventdefault","off","fadeOut","fadetime","fadeIn","removeAttr","dt","dataTable","api","columns","visible","append","viewhide_overrides","tr","row","child","isShown","removeClass","addClass","d","data","oldvalue","contents","el","nodeType","prepend","text","remove","override_form_label","o","length","first","clone","setup_override_form","html","dialog","modal","width","open","bind"],"mappings":"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","sourcesContent":["define(['jquery', 'jqueryui', 'block_integrityadvocate/jquery.dataTables'],\n        function ($, jqui, datatables) {\n            return {\n                init: function () {\n                    var debug = true;\n                    if ($('body').hasClass('block_integrityadvocate-overview-course')) {\n                        debug && window.console.log('Found overview_participants_table');\n                        // Configure element matched by selector as a DataTable, adding params to the default options.\n                        // DataTable options ref https://datatables.net/reference/option/.\n                        // Language options ref https://datatables.net/reference/option/language.\n                        var options = {\n                            'autoWidth': false,\n                            'columnDefs': [{'orderable': false, 'targets': [4, 5]}],\n                            'info': false,\n                            'language': {'search': M.str.moodle.filter + '&nbsp;'},\n                            'order': [], // Disable initial sort.\n                            'ordering': false,\n                            'paginate': false,\n                            'paging': false,\n                            'searching': true\n                        };\n                        $('#participants').DataTable(options);\n                    }\n\n                    if ($('body').hasClass('block_integrityadvocate-overview-user')) {\n                        debug && window.console.log('init.mins.js: Found overview_participant_table');\n                        // Re-usable reference to the holder of the DataTable.\n                        var dt_elt = $('#block_integrityadvocate_participant_table');\n\n                        var build_child_row = function (dataobject) {\n                            var childrow = '<table cellpadding=\"5\" cellspacing=\"0\" border=\"0\" style=\"padding-left:50px;\">' +\n                                    '<tr><td>Override time:</td><td>' + dataobject.overridetime + '</td></tr>' +\n                                    '<tr><td>Override original status:</td><td>' + dataobject.overridestatus + '</td></tr>' +\n                                    '<tr><td>Overrider:</td><td>' + dataobject.overrider + '</td></tr>' +\n                                    '<tr><td>Override reason:</td><td>' + dataobject.overridereason + '</td></tr>' +\n                                    '</table>';\n                            debug && window.console.log('Build childrow=', childrow);\n                            return childrow;\n                        };\n\n                        // Override UI ----------------------------------------\n                        class OverrideUi {\n                            constructor() {\n                                this.self = this;\n                                this.fadetime = 300;\n                                // Provide convenient access to the form components.\n                                this.frm = {};\n                                // Prefix used on most form items.\n                                this.prefix = 'block_integrityadvocate_override';\n                            }\n\n                            preventdefault = function (e) {\n                                if (typeof e !== 'undefined') {\n                                    e.preventDefault();\n                                }\n                                return false;\n                            }\n\n                            setup_override_form = function (elt) {\n                                debug && window.console.log('overrideui::setup_override_form::Started');\n                                var self = this;\n\n                                // Make easy-to-read refs to the form elements.\n                                this.frm = elt.find('.' + this.prefix + '_form');\n                                // The edit icon is outside the form.\n                                this.frm.elt_edit = elt.find('.' + this.prefix + '_edit');\n\n                                this.frm.elt_status = this.frm.find('.' + this.prefix + '_status_select');\n                                this.frm.elt_reason = this.frm.find('.' + this.prefix + '_reason');\n                                this.frm.userinputs = [this.frm.elt_status, this.frm.elt_reason];\n                                this.frm.elt_targetuserid = this.frm.find('.' + this.prefix + '_targetuserid');\n                                this.frm.elt_overrideuserid = this.frm.find('.' + this.prefix + '_overrideuserid');\n                                this.frm.elt_save = this.frm.find('.' + this.prefix + '_save');\n                                this.frm.elt_loading = this.frm.find('.' + this.prefix + '_loading');\n                                this.frm.elt_cancel = this.frm.find('.' + this.prefix + '_cancel');\n\n                                this.frm.elt_reason\n                                        .attr('placeholder', M.str.block_integrityadvocate.override_reason_label)\n                                        .attr('pattern', '^[a-zA-Z0-9\\ .,_-]{0,32}')\n                                        .on('keyup keypress', function (e) {\n                                            var keyCode = e.keyCode || e.which;\n                                            debug && window.console.log('overrideui::setup_override_form::Enter pressed');\n                                            if (keyCode === 13) {\n                                                self.frm.elt_save.click();\n\n                                                e.preventDefault();\n                                                return false;\n                                            }\n                                        });\n\n                                debug && window.console.log('overrideui::setup_override_form::Built frm', this.frm);\n\n                                this.frm.elt_loading.hide();\n                                this.save_set_status(false);\n                                this.frm.trigger('reset');\n\n                                this.frm.elt_save.on('click', function (e) {\n                                    debug && window.console.log('overrideui::setup_override_form::elt_save.on.click()::Started');\n                                    if (self.validate_all()) {\n                                        self.save_click();\n                                    }\n\n                                    e.preventDefault();\n                                    return false;\n                                });\n                                this.frm.elt_edit.on('click', function (e) {\n                                    self.show_overrideui();\n                                    e.preventDefault();\n                                    return false;\n                                });\n                                this.frm.elt_cancel.on('click', function (e) {\n                                    self.cancel_click();\n                                    e.preventDefault();\n                                    return false;\n                                });\n                                $(this.frm.userinputs).each(function (_, userinput) {\n                                    userinput.on('change keyup blur', function (e) {\n                                        self.save_set_status(self.validate_all());\n                                        e.preventDefault();\n                                        return false;\n                                    });\n                                });\n\n                                return this;\n                            }\n\n                            cancel_click = function () {\n                                this.frm.trigger('reset');\n                                this.hide_overrideui();\n                                this.frm.closest('td').find('.oldstatusinfo, .block_integrityadvocate_overriden_icon').show();\n                                // Show all the override edit icons on the page.\n                                $('.block_integrityadvocate_override_edit').show();\n                            }\n\n                            save_click = function () {\n                                var self = this;\n                                this.disable_ui();\n                                debug && window.console.log('overrideui::save_click::Started with frm=', this.frm);\n\n                                var url = new URL(window.location.href);\n\n                                require(['core/ajax', 'core/notification'], function (ajax, notification) {\n                                    ajax.call([{\n                                            methodname: 'block_integrityadvocate_set_override',\n                                            args: {\n                                                status: self.frm.elt_status.val(),\n                                                reason: self.frm.elt_reason.val(),\n                                                targetuserid: self.frm.elt_targetuserid.val(),\n                                                overrideuserid: self.frm.elt_overrideuserid.val(),\n                                                blockinstanceid: url.searchParams.get('instanceid'),\n                                                moduleid: self.frm.parents('tr').find('.block_integrityadvocate_participant_activitymodule').attr('data-cmid')\n                                            },\n                                            done: function (context) {\n                                                debug && window.console.log('overrideui::save_click::ajax.done');\n                                                // Set true to force reload from server not cache.  This is said to be deprecated but since we might have old browsers we'll do it.\n                                                window.location.reload(true);\n                                            },\n                                            fail: notification.exception,\n                                            always: function (context) {\n                                                debug && window.console.log('overrideui::save_click::ajax.always');\n                                                self.enable_ui();\n                                                self.cancel_click();\n                                            }\n                                        }]);\n                                });\n\n                                debug && window.console.log('overrideui::save_click::Done');\n                            }\n\n                            validate_all = function () {\n                                // We explicity want to run through both validators, so don't just AND them.\n                                var isvalid_reason = this.validate_reason();\n                                var isvalid_status = this.validate_status();\n\n                                return isvalid_reason && isvalid_status;\n                            }\n\n                            validate_status = function () {\n                                var elt = this.frm.elt_status;\n                                var val = elt.val();\n\n                                // Only values 0 and 3 are acceptable ATM.\n                                return elt[0].checkValidity() || val === 0 || val === 3;\n                            }\n\n                            validate_reason = function () {\n                                var elt = this.frm.elt_reason;\n                                var val = elt.val();\n                                debug && window.console.log('overrideui::validate_reason::Started with frm=', this.frm);\n                                debug && window.console.log('overrideui::validate_reason::Started with elt=', elt);\n\n                                // Clear the custom validity message b/c having it there cause checkValidity() to return false.\n                                elt[0].setCustomValidity('');\n\n                                if (val === '' || elt[0].checkValidity()) {\n                                    return true;\n                                } else {\n                                    elt[0].setCustomValidity(M.str.block_integrityadvocate.override_reason_invalid);\n                                    return false;\n                                }\n                            }\n\n                            save_set_status = function (enabled) {\n                                if (enabled) {\n                                    this.save_enable();\n                                } else {\n                                    this.save_disable();\n                                }\n                            }\n\n                            save_disable = function () {\n                                var self = this;\n                                this.frm.elt_save.css('color', 'grey').on('click.' + self.prefix + '_disable', this.preventdefault);\n                            }\n\n                            save_enable = function () {\n                                var self = this;\n                                this.frm.elt_save.css('color', '').off('click.' + self.prefix + '_disable');\n                            }\n\n                            show_overrideui = function () {\n                                this.frm.elt_edit.hide();\n                                this.frm.show();\n                                // Make the save icon blink for visibility.\n                                this.frm.elt_save.fadeOut(this.fadetime).fadeIn(this.fadetime);\n                                this.validate_all();\n                            }\n\n                            hide_overrideui = function () {\n                                this.frm.hide();\n                                this.frm.elt_edit.fadeIn(this.fadetime);\n                            }\n\n                            disable_ui = function () {\n                                this.frm.elt_cancel.hide();\n                                this.frm.elt_save.hide();\n                                this.frm.elt_loading.show();\n                                $(this.frm.userinputs).each(function (_, userinput) {\n                                    userinput.attr('disabled', 'disabled');\n                                });\n                            }\n\n                            enable_ui = function () {\n                                this.frm.elt_cancel.show();\n                                this.frm.elt_save.show();\n                                this.frm.elt_loading.hide();\n                                $(this.frm.userinputs).each(function (_, userinput) {\n                                    userinput.removeAttr('disabled');\n                                });\n                            }\n                        }\n                        // End Override UI ------------------------------------\n\n                        // Configure element matched by selector as a DataTable, adding params to the default options.\n                        // DataTable options ref https://datatables.net/reference/option/.\n                        // Language options ref https://datatables.net/reference/option/language.\n                        var options = {\n                            'autoWidth': true,\n                            'language': {'search': M.str.moodle.filter + '&nbsp;'},\n                            'ordering': true,\n                            'order': [[0, 'desc'], [1, 'desc']],\n                            'paging': false,\n                            'row-border': true,\n                            'searching': true,\n                            'scrollX': true,\n                            'columnDefs': [\n                                {\n                                    'targets': [4],\n                                    'orderable': false,\n                                    'searchable': false\n                                }],\n                            'initComplete': function (settings, json) {\n                                debug && window.console.log('DataTables.initComplete fired');\n                                // Re-usable reference to the DataTable.\n                                var dt = dt_elt.dataTable();\n                                // Hide the override columns.\n                                dt.api().columns([6, 7, 8, 9]).visible(false);\n\n                                // If overridden, show more info in child row.\n                                dt_elt.find('.block_integrityadvocate_participant_session_overridden').each(function () {\n                                    $(this).append('<i class=\"fa fa-chevron-circle-down block_integrityadvocate_overriden_icon\" aria-hidden=\"true\" title=\"' + M.str.block_integrityadvocate.viewhide_overrides + '\"></i>');\n                                    $(this).find('i.block_integrityadvocate_overriden_icon').click(function () {\n                                        debug && window.console.log('click.override fired');\n                                        var tr = $(this).parents('tr');\n                                        var row = dt.api().row(tr);\n\n                                        if (row.child.isShown()) {\n                                            debug && window.console.log('This row is already open - close it');\n                                            row.child.hide();\n                                            tr.removeClass('shown');\n                                            $(this).removeClass('fa-chevron-circle-up').addClass('fa-chevron-circle-down');\n                                        } else {\n                                            debug && window.console.log('Open this row');\n                                            var d = {\n                                                overridetime: row.data()[6],\n                                                overridestatus: row.data()[7],\n                                                overrider: row.data()[8],\n                                                overridereason: row.data()[9]\n                                            };\n                                            row.child(build_child_row(d)).show();\n                                            tr.addClass('shown');\n                                            $(this).removeClass('fa-chevron-circle-down').addClass('fa-chevron-circle-up');\n                                        }\n                                    });\n                                });\n\n                                // If can override, show the edit icon and add click event.\n                                dt_elt.find('.block_integrityadvocate_participant_session_overrideui').each(function () {\n                                    var elt = $(this);\n                                    // Wrap existing value (text in root element only) in a div so we can hide/show it later.\n                                    var oldvalue = elt.contents().filter((_, el) => el.nodeType === 3);\n                                    elt.prepend('<div class=\"oldstatusinfo\">' + oldvalue.text() + '</div>');\n                                    oldvalue.remove();\n\n                                    elt.append('<i class=\"fa fa-pencil-square-o block_integrityadvocate_override_edit\" aria-hidden=\"true\" title=\"' + M.str.block_integrityadvocate.override_form_label + '\"></i>');\n                                    var o = new OverrideUi();\n                                    elt.find('i.block_integrityadvocate_override_edit').click(function () {\n                                        debug && window.console.log('overrideui::add_override_click::Override button clicked');\n                                        var elt_overrideui;\n                                        var selector_overrideform = '.block_integrityadvocate_override_form';\n                                        debug && window.console.log('overrideui::add_override_click::No existing form found');\n                                        elt.find('.oldstatusinfo').hide();\n                                        //debug && window.console.log('overrideui::add_override_click::form', elt.find(selector_overrideform));\n\n                                        // Add the editing form and init it.\n                                        if (elt.find(selector_overrideform).length < 1) {\n                                            debug && window.console.log('overrideui::add_override_click::Add the editing form and init it');\n\n                                            // Copies the form into elt.\n                                            elt.append($(selector_overrideform).first().clone());\n                                            //debug && window.console.log('overrideui::add_override_click::after append elt.html=', elt.html());\n\n                                            elt.find(selector_overrideform).show();\n                                            elt_overrideui = o.setup_override_form(elt);\n                                        } else {\n                                            debug && window.console.log('overrideui::add_override_click::Existing form found - show it');\n                                            elt.find(selector_overrideform).show();\n                                        }\n\n                                        // Hide all the override edit icons on the page.\n                                        $('.block_integrityadvocate_override_edit').hide();\n                                        elt.find('.block_integrityadvocate_overriden_icon').hide();\n                                        o.show_overrideui();\n                                    });\n                                });\n\n                                // Show user picture full size in modal.\n                                dt_elt.find('.block_integrityadvocate_participant_session_jquimodal').on('click.modalpic', function () {\n                                    debug && window.console.log('jquimodal.click.modalpic fired');\n                                    $('#dialog')\n                                            .html('<div id=\"dialog\" title=\"image\"><img src=\"' + $(this).attr('src') + '\" width=\"500\" /></div>')\n                                            .dialog({\n                                                modal: true,\n                                                width: 'auto',\n                                                open: function (event, ui) {\n                                                    $('.ui-widget-overlay').bind('click', function () {\n                                                        $(\"#dialog\").dialog('close');\n                                                    });\n                                                }\n                                            });\n                                });\n                            }\n                        };\n                        dt_elt.dataTable(options);\n                    }\n                }\n            };\n        }\n);\n"],"file":"init.min.js"}